# åç«¯å¼€å‘è§„èŒƒ (Python Flask)

## ğŸ“‚ æ–‡ä»¶ç»„ç»‡è§„èŒƒ

### æ§åˆ¶å™¨å±‚ ([`api/controllers/`](mdc:api/controllers/))
```python
# æ§åˆ¶å™¨å‘½å: {æ¨¡å—å}_controller.py
# ç¤ºä¾‹: user_controller.py, app_controller.py

from flask import Blueprint, request, jsonify
from services.user_service import UserService

bp = Blueprint('user', __name__, url_prefix='/api/users')

@bp.route('/', methods=['GET'])
def list_users():
    """è·å–ç”¨æˆ·åˆ—è¡¨"""
    # ç®€æ´çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¤æ‚é€»è¾‘æ”¾åˆ°serviceå±‚
    pass
```

### æœåŠ¡å±‚ ([`api/services/`](mdc:api/services/))
```python
# æœåŠ¡å‘½å: {æ¨¡å—å}_service.py
# ä¸šåŠ¡é€»è¾‘çš„æ ¸å¿ƒå®ç°

class UserService:
    @staticmethod
    def create_user(user_data: dict) -> dict:
        """
        åˆ›å»ºç”¨æˆ·
        Args:
            user_data: ç”¨æˆ·æ•°æ®å­—å…¸
        Returns:
            åˆ›å»ºçš„ç”¨æˆ·ä¿¡æ¯
        Raises:
            ValidationError: æ•°æ®éªŒè¯å¤±è´¥
        """
        # åœ¨è¿™é‡Œå®ç°å…·ä½“çš„ä¸šåŠ¡é€»è¾‘
        pass
```

### æ•°æ®æ¨¡å‹ ([`api/models/`](mdc:api/models/))
```python
# ä½¿ç”¨SQLAlchemyå®šä¹‰æ•°æ®æ¨¡å‹
from sqlalchemy import Column, String, DateTime
from extensions.ext_database import db

class User(db.Model):
    __tablename__ = 'users'
    
    id = Column(String(36), primary_key=True)
    email = Column(String(255), nullable=False, unique=True)
    created_at = Column(DateTime, nullable=False, default=datetime.utcnow)
```

## ğŸ›¡ï¸ å¼€å‘è§„èŒƒ

### 1. é”™è¯¯å¤„ç†
```python
from libs.exception import BaseHTTPException

# ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸ç±»
class UserNotFoundError(BaseHTTPException):
    error_code = 'USER_NOT_FOUND'
    description = "ç”¨æˆ·ä¸å­˜åœ¨"
    code = 404

# åœ¨æœåŠ¡ä¸­æŠ›å‡ºå¼‚å¸¸
if not user:
    raise UserNotFoundError()
```

### 2. æ•°æ®éªŒè¯
```python
from pydantic import BaseModel, validator

class UserCreateRequest(BaseModel):
    email: str
    password: str
    
    @validator('email')
    def validate_email(cls, v):
        # é‚®ç®±æ ¼å¼éªŒè¯
        if '@' not in v:
            raise ValueError('æ— æ•ˆçš„é‚®ç®±æ ¼å¼')
        return v
```

### 3. æ•°æ®åº“æ“ä½œ
```python
# ä½¿ç”¨äº‹åŠ¡ç¡®ä¿æ•°æ®ä¸€è‡´æ€§
from extensions.ext_database import db

def create_user_with_profile(user_data, profile_data):
    try:
        with db.session.begin():
            user = User(**user_data)
            db.session.add(user)
            db.session.flush()  # è·å–user.id
            
            profile = UserProfile(user_id=user.id, **profile_data)
            db.session.add(profile)
            
        return user
    except Exception as e:
        db.session.rollback()
        raise e
```

### 4. é…ç½®ç®¡ç†
```python
# ä½¿ç”¨ç¯å¢ƒå˜é‡å’Œé…ç½®ç±»
from configs.app_config import DifyConfig

# è·å–é…ç½®
database_url = DifyConfig.SQLALCHEMY_DATABASE_URI
redis_url = DifyConfig.REDIS_URL
```

### 5. æ—¥å¿—è®°å½•
```python
import logging

logger = logging.getLogger(__name__)

def process_data():
    logger.info("å¼€å§‹å¤„ç†æ•°æ®")
    try:
        # ä¸šåŠ¡é€»è¾‘
        pass
    except Exception as e:
        logger.error(f"å¤„ç†æ•°æ®å¤±è´¥: {str(e)}")
        raise
```

## ğŸš« é¿å…çš„åæ¨¡å¼

1. **ä¸è¦**åœ¨æ§åˆ¶å™¨ä¸­å†™å¤æ‚ä¸šåŠ¡é€»è¾‘
2. **ä¸è¦**ç›´æ¥åœ¨è§†å›¾ä¸­æ“ä½œæ•°æ®åº“
3. **ä¸è¦**ç¡¬ç¼–ç é…ç½®ä¿¡æ¯
4. **ä¸è¦**å¿½ç•¥å¼‚å¸¸å¤„ç†
5. **ä¸è¦**å†™è¿‡æ·±çš„åµŒå¥—ä»£ç ï¼ˆè¶…è¿‡3å±‚ï¼‰

## ğŸ“ æ³¨é‡Šè§„èŒƒ

```python
def complex_algorithm(data: list, threshold: float) -> dict:
    """
    å¤æ‚ç®—æ³•çš„å®ç°
    
    è¿™æ˜¯ä¸€ä¸ªç›¸å¯¹å¤æ‚çš„ä¸šåŠ¡é€»è¾‘å‡½æ•°ï¼Œéœ€è¦è¯¦ç»†è¯´æ˜ï¼š
    1. æ•°æ®é¢„å¤„ç†å’ŒéªŒè¯
    2. æ ¸å¿ƒç®—æ³•é€»è¾‘
    3. ç»“æœæ ¼å¼åŒ–å’Œè¿”å›
    
    Args:
        data: è¾“å…¥æ•°æ®åˆ—è¡¨
        threshold: é˜ˆå€¼å‚æ•°ï¼Œç”¨äºè¿‡æ»¤
        
    Returns:
        å¤„ç†ç»“æœå­—å…¸ï¼ŒåŒ…å«å¤„ç†çŠ¶æ€å’Œæ•°æ®
        
    Raises:
        ValueError: å½“è¾“å…¥æ•°æ®æ ¼å¼é”™è¯¯æ—¶
    """
    # æ­¥éª¤1ï¼šæ•°æ®éªŒè¯
    if not data or threshold < 0:
        raise ValueError("è¾“å…¥å‚æ•°æ— æ•ˆ")
    
    # æ­¥éª¤2ï¼šæ•°æ®å¤„ç†ï¼ˆå¤æ‚é€»è¾‘éœ€è¦æ³¨é‡Šè¯´æ˜ï¼‰
    processed_data = []
    for item in data:
        # åº”ç”¨é˜ˆå€¼è¿‡æ»¤
        if item.score >= threshold:
            processed_data.append(transform_item(item))
    
    # æ­¥éª¤3ï¼šè¿”å›ç»“æœ
    return {
        'success': True,
        'count': len(processed_data),
        'data': processed_data
    }
```

## ğŸ§ª ä¸ä¸»åŠ¨è¿è¡Œæµ‹è¯•

æ ¹æ®ç”¨æˆ·è¦æ±‚ï¼Œä»£ç å¼€å‘å®Œæˆå**ä¸è¦ä¸»åŠ¨è¿è¡Œæµ‹è¯•å‘½ä»¤**ï¼Œä½†ä»£ç åº”è¯¥æ˜¯å¯æµ‹è¯•çš„ï¼š

```python
# ç¼–å†™æ˜“äºæµ‹è¯•çš„ä»£ç 
def calculate_total(items: list) -> float:
    """è®¡ç®—æ€»ä»· - çº¯å‡½æ•°ï¼Œæ˜“äºæµ‹è¯•"""
    return sum(item.price * item.quantity for item in items)

# é¿å…éš¾ä»¥æµ‹è¯•çš„ä»£ç 
def process_order():
    """é¿å…ï¼šåœ¨å‡½æ•°å†…éƒ¨ç›´æ¥è®¿é—®æ•°æ®åº“å’Œå¤–éƒ¨æœåŠ¡"""
    user = User.query.get(1)  # éš¾ä»¥mock
    send_email(user.email)    # éš¾ä»¥æµ‹è¯•
```
description:åç«¯å¼€å‘è§„åˆ™
globs:
alwaysApply: false
---
