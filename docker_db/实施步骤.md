# Dify å®¶åº­æœåŠ¡å™¨ Docker éƒ¨ç½²å®Œæ•´ä½¿ç”¨æŒ‡å—

## ğŸ“– ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [è„šæœ¬å‘½ä»¤è¯¦è§£](#è„šæœ¬å‘½ä»¤è¯¦è§£)
3. [é…ç½®æ–‡ä»¶è¯´æ˜](#é…ç½®æ–‡ä»¶è¯´æ˜)
4. [æ•°æ®åº“æ“ä½œæŒ‡å—](#æ•°æ®åº“æ“ä½œæŒ‡å—)
5. [æ•°æ®æŒä¹…åŒ–ç®¡ç†](#æ•°æ®æŒä¹…åŒ–ç®¡ç†)
6. [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
7. [é«˜çº§ç”¨æ³•](#é«˜çº§ç”¨æ³•)
8. [ç»´æŠ¤å’Œç›‘æ§](#ç»´æŠ¤å’Œç›‘æ§)

---

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

### **é¡¹ç›®ç»“æ„**
```
dify-server/
â”œâ”€â”€ docker-compose.yml          # DockeræœåŠ¡ç¼–æ’æ–‡ä»¶
â”œâ”€â”€ docker-setup-updated.sh     # ä¸»ç®¡ç†è„šæœ¬
â”œâ”€â”€ dify.env                    # ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€â”€ redis.conf                 # Redisé…ç½®æ–‡ä»¶
â”œâ”€â”€ init-scripts/              # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”‚   â””â”€â”€ 01-init.sql
â”œâ”€â”€ backups/                   # å¤‡ä»½æ–‡ä»¶ç›®å½•
â”œâ”€â”€ logs/                      # æ—¥å¿—æ–‡ä»¶ç›®å½•
â””â”€â”€ connection-info.md         # è¿æ¥ä¿¡æ¯æ–‡æ¡£
```

### **æœåŠ¡ç»„ä»¶**
- **PostgreSQL 15** - ä¸»æ•°æ®åº“ (ç«¯å£: 5432)
- **Redis 7** - ç¼“å­˜å’Œä¼šè¯å­˜å‚¨ (ç«¯å£: 6379)
- **Weaviate 1.19** - å‘é‡æ•°æ®åº“ (ç«¯å£: 8080)

### **æ•°æ®æŒä¹…åŒ–**
- ä½¿ç”¨Dockerå‘½åå·ç¡®ä¿æ•°æ®å®‰å…¨
- æ”¯æŒå®Œæ•´å¤‡ä»½å’Œæ¢å¤
- å®¹å™¨é‡å¯æ•°æ®ä¸ä¸¢å¤±

---

## ğŸ”§ è„šæœ¬å‘½ä»¤è¯¦è§£

### **åŸºç¡€å‘½ä»¤**

#### **1. setup - åˆå§‹åŒ–éƒ¨ç½²**
```bash
./docker-setup-updated.sh setup
```

**åŠŸèƒ½ï¼š**
- æ£€æŸ¥Dockerç¯å¢ƒä¾èµ–
- è‡ªåŠ¨æ£€æµ‹æœåŠ¡å™¨IPåœ°å€
- éªŒè¯é…ç½®æ–‡ä»¶å®Œæ•´æ€§
- åŒæ­¥å¯†ç é…ç½®
- æ‹‰å–Dockeré•œåƒ
- åˆ›å»ºå¿…è¦ç›®å½•

**ä½¿ç”¨åœºæ™¯ï¼š**
- é¦–æ¬¡éƒ¨ç½²æ—¶ä½¿ç”¨
- é‡æ–°é…ç½®ç¯å¢ƒæ—¶ä½¿ç”¨

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
[INFO] åˆå§‹åŒ– Dify å®¶åº­æœåŠ¡å™¨éƒ¨ç½²...
[SUCCESS] ä¾èµ–æ£€æŸ¥é€šè¿‡
[SUCCESS] é…ç½®æ–‡ä»¶æ£€æŸ¥é€šè¿‡
[SUCCESS] é…ç½®éªŒè¯é€šè¿‡
[SUCCESS] ç¯å¢ƒé…ç½®å·²æ›´æ–°: 192.168.1.100
[SUCCESS] Rediså¯†ç å·²åŒæ­¥
[INFO] æ‹‰å–Dockeré•œåƒ...
[SUCCESS] åˆå§‹åŒ–å®Œæˆï¼
```

#### **2. start - å¯åŠ¨æœåŠ¡**
```bash
./docker-setup-updated.sh start
```

**åŠŸèƒ½ï¼š**
- å¯åŠ¨å‰è‡ªåŠ¨åŒæ­¥å¯†ç é…ç½®
- å¯åŠ¨æ‰€æœ‰Dockerå®¹å™¨
- ç­‰å¾…æœåŠ¡å®Œå…¨å¯åŠ¨
- æ˜¾ç¤ºæœåŠ¡çŠ¶æ€æŠ¥å‘Š

**å¯åŠ¨é¡ºåºï¼š**
1. PostgreSQL (çº¦10ç§’)
2. Redis (çº¦5ç§’)
3. Weaviate (çº¦30ç§’)

#### **3. stop - åœæ­¢æœåŠ¡**
```bash
./docker-setup-updated.sh stop
```

**åŠŸèƒ½ï¼š**
- ä¼˜é›…åœæ­¢æ‰€æœ‰å®¹å™¨
- ä¿ç•™æ•°æ®å·å’Œç½‘ç»œ

#### **4. restart - é‡å¯æœåŠ¡**
```bash
./docker-setup-updated.sh restart
```

**åŠŸèƒ½ï¼š**
- å…ˆåœæ­¢æ‰€æœ‰æœåŠ¡
- ç­‰å¾…5ç§’
- é‡æ–°å¯åŠ¨æ‰€æœ‰æœåŠ¡

### **ç›‘æ§å‘½ä»¤**

#### **5. status - æŸ¥çœ‹æœåŠ¡çŠ¶æ€**
```bash
./docker-setup-updated.sh status
```

**æ˜¾ç¤ºå†…å®¹ï¼š**
- Dockerå®¹å™¨è¿è¡ŒçŠ¶æ€
- æœåŠ¡å¥åº·æ£€æŸ¥ç»“æœ
- ç«¯å£ç›‘å¬çŠ¶æ€

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
=== Dify æœåŠ¡å™¨çŠ¶æ€ ===

Docker å®¹å™¨çŠ¶æ€:
NAME            IMAGE                           STATUS
dify-postgres   postgres:15-alpine             Up 5 minutes (healthy)
dify-redis      redis:7-alpine                 Up 5 minutes (healthy)  
dify-weaviate   semitechnologies/weaviate:1.19.0   Up 5 minutes (healthy)

æœåŠ¡å¥åº·çŠ¶æ€:
âœ… PostgreSQL: å¥åº·
âœ… Redis: å¥åº·
âœ… Weaviate: å¥åº·
```
<code_block_to_apply_changes_from>
```
[INFO] åŒæ­¥é…ç½®æ–‡ä»¶å¯†ç ...
[INFO] ä»ç¯å¢ƒæ–‡ä»¶è¯»å–çš„Rediså¯†ç : MyNewPassword123
[INFO] å½“å‰redis.confä¸­çš„å¯†ç : OldPassword123
[WARNING] Rediså¯†ç ä¸åŒ¹é…ï¼Œæ­£åœ¨åŒæ­¥...
[SUCCESS] Redisé…ç½®å·²åŒæ­¥

=== å¯†ç é…ç½®æ‘˜è¦ ===
PostgreSQLå¯†ç : MyPostgresPassword123
Rediså¯†ç : MyNewPassword123
Weaviate API Key: MyWeaviateKey123
```

#### **9. info - æ˜¾ç¤ºè¿æ¥ä¿¡æ¯**
```bash
./docker-setup-updated.sh info
```

**æ˜¾ç¤ºå†…å®¹ï¼š**
- æœåŠ¡å™¨IPå’Œç«¯å£ä¿¡æ¯
- æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
- APIå¯†é’¥ä¿¡æ¯
- é˜²ç«å¢™é…ç½®å‘½ä»¤
- å¯†ç åŒæ­¥çŠ¶æ€

### **æ•°æ®ç®¡ç†å‘½ä»¤**

#### **10. backup - æ•°æ®å¤‡ä»½**
```bash
./docker-setup-updated.sh backup
```

**å¤‡ä»½å†…å®¹ï¼š**
- PostgreSQLæ•°æ®åº“å¯¼å‡º (SQLæ ¼å¼)
- Redisæ•°æ®å¯¼å‡º (RDBæ ¼å¼)
- Weaviateæ•°æ®å·å¤‡ä»½ (tar.gzæ ¼å¼)
- é…ç½®æ–‡ä»¶å¤‡ä»½

**å¤‡ä»½ä½ç½®ï¼š**
```
backups/20241219_143022/
â”œâ”€â”€ postgres_backup.sql      # PostgreSQLæ•°æ®
â”œâ”€â”€ redis_backup.rdb         # Redisæ•°æ®
â”œâ”€â”€ weaviate_backup.tar.gz   # Weaviateæ•°æ®
â”œâ”€â”€ config_backup.tar.gz     # é…ç½®æ–‡ä»¶
â””â”€â”€ backup_info.txt          # å¤‡ä»½ä¿¡æ¯
```

**è‡ªåŠ¨æ¸…ç†ï¼š**
- ä¿ç•™æœ€è¿‘7å¤©çš„å¤‡ä»½
- è‡ªåŠ¨åˆ é™¤è¿‡æœŸå¤‡ä»½

#### **11. clean - æ¸…ç†æ•°æ®**
```bash
./docker-setup-updated.sh clean
```

**âš ï¸ å±é™©æ“ä½œ - éœ€è¦ç¡®è®¤**
- åœæ­¢æ‰€æœ‰æœåŠ¡
- åˆ é™¤æ‰€æœ‰æ•°æ®å·
- æ¸…ç©ºæ•°æ®åº“å†…å®¹
- éœ€è¦è¾“å…¥ 'YES' ç¡®è®¤

---

## âš™ï¸ é…ç½®æ–‡ä»¶è¯´æ˜

### **dify.env - ç¯å¢ƒå˜é‡é…ç½®**

```env
# =================================
# ç«¯å£é…ç½®
# =================================
POSTGRES_PORT=5432
REDIS_PORT=6379
WEAVIATE_PORT=8080

# =================================
# PostgreSQL æ•°æ®åº“é…ç½®
# =================================
POSTGRES_DB=dify
POSTGRES_USER=dify
POSTGRES_PASSWORD=MySecurePassword123

# =================================
# Redis é…ç½®
# =================================
REDIS_PASSWORD=MyRedisPassword123

# =================================
# Weaviate å‘é‡æ•°æ®åº“é…ç½®
# =================================
WEAVIATE_API_KEY=MyWeaviateKey123

# =================================
# æœåŠ¡å™¨é…ç½®
# =================================
SERVER_IP=192.168.1.100
```

**é…ç½®è¯´æ˜ï¼š**
- **ç«¯å£é…ç½®**ï¼šå¯è‡ªå®šä¹‰å„æœåŠ¡ç«¯å£
- **å¯†ç é…ç½®**ï¼šå»ºè®®ä½¿ç”¨å¼ºå¯†ç 
- **æœåŠ¡å™¨IP**ï¼šè‡ªåŠ¨æ£€æµ‹ï¼Œå¯æ‰‹åŠ¨ä¿®æ”¹

### **redis.conf - Redisé…ç½®**

```conf
# ç½‘ç»œé…ç½®
bind 0.0.0.0
port 6379
protected-mode no

# è®¤è¯
requirepass MyRedisPassword123

# å†…å­˜ç®¡ç†
maxmemory 1gb
maxmemory-policy allkeys-lru

# æŒä¹…åŒ–é…ç½®
save 900 1
save 300 10
save 60 10000
appendonly yes
appendfsync everysec
```

**é‡è¦é…ç½®ï¼š**
- **requirepass**ï¼šå¿…é¡»ä¸ `dify.env` ä¸­çš„ `REDIS_PASSWORD` ä¸€è‡´
- **maxmemory**ï¼šæ ¹æ®æœåŠ¡å™¨å†…å­˜è°ƒæ•´
- **æŒä¹…åŒ–**ï¼šç¡®ä¿æ•°æ®å®‰å…¨

### **docker-compose.yml - æœåŠ¡ç¼–æ’**

**æ•°æ®å·é…ç½®ï¼š**
```yaml
volumes:
  postgres_data:    # PostgreSQLæ•°æ®æŒä¹…åŒ–
    driver: local
  redis_data:       # Redisæ•°æ®æŒä¹…åŒ–
    driver: local
  weaviate_data:    # Weaviateæ•°æ®æŒä¹…åŒ–
    driver: local
```

**ç½‘ç»œé…ç½®ï¼š**
```yaml
networks:
  dify-network:
    driver: bridge
```

---

## ğŸ—„ï¸ æ•°æ®åº“æ“ä½œæŒ‡å—

### **PostgreSQL æ•°æ®åº“æ“ä½œ**

#### **è¿æ¥æ•°æ®åº“**
```bash
# æ–¹å¼1ï¼šä½¿ç”¨å®¹å™¨å†…psql
docker exec -it dify-postgres psql -U dify -d dify

# æ–¹å¼2ï¼šä»å¤–éƒ¨è¿æ¥
psql "postgresql://dify:password@192.168.1.100:5432/dify"
```

#### **å¸¸ç”¨SQLæ“ä½œ**
```sql
-- æŸ¥çœ‹æ•°æ®åº“ç‰ˆæœ¬
SELECT version();

-- æŸ¥çœ‹æ‰€æœ‰è¡¨
\dt

-- æŸ¥çœ‹è¡¨ç»“æ„
\d table_name

-- åˆ›å»ºæµ‹è¯•è¡¨
CREATE TABLE test_users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- æ’å…¥æµ‹è¯•æ•°æ®
INSERT INTO test_users (username, email) VALUES 
('user1', 'user1@example.com'),
('user2', 'user2@example.com');

-- æŸ¥è¯¢æ•°æ®
SELECT * FROM test_users;

-- åˆ é™¤æµ‹è¯•è¡¨
DROP TABLE test_users;
```

#### **æ•°æ®åº“ç®¡ç†**
```bash
# åˆ›å»ºæ•°æ®åº“å¤‡ä»½
docker exec -t dify-postgres pg_dump -U dify dify > backup.sql

# æ¢å¤æ•°æ®åº“
cat backup.sql | docker exec -i dify-postgres psql -U dify -d dify

# æŸ¥çœ‹æ•°æ®åº“å¤§å°
docker exec -it dify-postgres psql -U dify -d dify -c "
SELECT 
    pg_database.datname,
    pg_size_pretty(pg_database_size(pg_database.datname)) AS size
FROM pg_database;"

# æŸ¥çœ‹è¡¨å¤§å°
docker exec -it dify-postgres psql -U dify -d dify -c "
SELECT 
    schemaname,
    tablename,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS size
FROM pg_tables 
WHERE schemaname = 'public'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;"
```

### **Redis ç¼“å­˜æ“ä½œ**

#### **è¿æ¥Redis**
```bash
# è¿æ¥Redis (éœ€è¦å¯†ç )
docker exec -it dify-redis redis-cli -a MyRedisPassword123

# æµ‹è¯•è¿æ¥
docker exec -it dify-redis redis-cli -a MyRedisPassword123 ping
```

#### **å¸¸ç”¨Rediså‘½ä»¤**
```bash
# åŸºç¡€æ“ä½œ
SET key "value"
GET key
DEL key
EXISTS key

# åˆ—è¡¨æ“ä½œ
LPUSH mylist "item1"
LPUSH mylist "item2"
LRANGE mylist 0 -1
LLEN mylist

# å“ˆå¸Œæ“ä½œ
HSET user:1 name "John"
HSET user:1 email "john@example.com"
HGET user:1 name
HGETALL user:1

# é›†åˆæ“ä½œ
SADD myset "member1"
SADD myset "member2"
SMEMBERS myset

# æœ‰åºé›†åˆæ“ä½œ
ZADD leaderboard 100 "player1"
ZADD leaderboard 200 "player2"
ZRANGE leaderboard 0 -1 WITHSCORES

# è¿‡æœŸæ—¶é—´
EXPIRE key 3600  # è®¾ç½®1å°æ—¶è¿‡æœŸ
TTL key          # æŸ¥çœ‹å‰©ä½™æ—¶é—´
```

#### **Redisç›‘æ§**
```bash
# æŸ¥çœ‹Redisä¿¡æ¯
docker exec -it dify-redis redis-cli -a MyRedisPassword123 INFO

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
docker exec -it dify-redis redis-cli -a MyRedisPassword123 INFO memory

# æŸ¥çœ‹è¿æ¥æ•°
docker exec -it dify-redis redis-cli -a MyRedisPassword123 INFO clients

# å®æ—¶ç›‘æ§å‘½ä»¤
docker exec -it dify-redis redis-cli -a MyRedisPassword123 MONITOR

# æŸ¥çœ‹æ…¢æŸ¥è¯¢
docker exec -it dify-redis redis-cli -a MyRedisPassword123 SLOWLOG GET 10
```

### **Weaviate å‘é‡æ•°æ®åº“æ“ä½œ**

#### **APIè®¿é—®**
```bash
# æ£€æŸ¥WeaviateçŠ¶æ€
curl -H "Authorization: Bearer MyWeaviateKey123" \
     http://192.168.1.100:8080/v1/.well-known/ready

# è·å–é›†ç¾¤ä¿¡æ¯
curl -H "Authorization: Bearer MyWeaviateKey123" \
     http://192.168.1.100:8080/v1/meta

# æŸ¥çœ‹schema
curl -H "Authorization: Bearer MyWeaviateKey123" \
     http://192.168.1.100:8080/v1/schema
```

#### **Pythonå®¢æˆ·ç«¯ç¤ºä¾‹**
```python
import weaviate

# è¿æ¥Weaviate
client = weaviate.Client(
    url="http://192.168.1.100:8080",
    auth_client_secret=weaviate.AuthApiKey(api_key="MyWeaviateKey123")
)

# æ£€æŸ¥è¿æ¥
print(client.is_ready())

# åˆ›å»ºç±»ï¼ˆschemaï¼‰
class_schema = {
    "class": "Document",
    "description": "A document with text content",
    "properties": [
        {
            "name": "content",
            "dataType": ["text"],
            "description": "The content of the document"
        },
        {
            "name": "title", 
            "dataType": ["string"],
            "description": "The title of the document"
        }
    ]
}

client.schema.create_class(class_schema)

# æ·»åŠ æ•°æ®
client.data_object.create(
    data_object={
        "content": "This is a sample document content",
        "title": "Sample Document"
    },
    class_name="Document"
)

# æœç´¢
result = client.query.get("Document", ["content", "title"]).do()
print(result)
```

---

## ğŸ’¾ æ•°æ®æŒä¹…åŒ–ç®¡ç†

### **æ•°æ®å·ç®¡ç†**

#### **æŸ¥çœ‹æ•°æ®å·**
```bash
# æŸ¥çœ‹æ‰€æœ‰æ•°æ®å·
docker volume ls

# æŸ¥çœ‹Difyç›¸å…³æ•°æ®å·
docker volume ls | grep docker_db

# æŸ¥çœ‹æ•°æ®å·è¯¦ç»†ä¿¡æ¯
docker volume inspect docker_db_postgres_data
docker volume inspect docker_db_redis_data
```

---

## ğŸ¯ å®æ–½æ£€æŸ¥æ¸…å•

### éƒ¨ç½²å®Œæˆæ£€æŸ¥

- [ ] Dockerç¯å¢ƒå®‰è£…æˆåŠŸ
- [ ] æ‰€æœ‰é…ç½®æ–‡ä»¶åˆ›å»ºå®Œæˆ
- [ ] æœåŠ¡åˆå§‹åŒ–æˆåŠŸ
- [ ] ä¸‰ä¸ªæœåŠ¡éƒ½å¤„äºå¥åº·çŠ¶æ€
- [ ] é˜²ç«å¢™é…ç½®æ­£ç¡®
- [ ] ç½‘ç»œè¿æ¥æµ‹è¯•é€šè¿‡
- [ ] å¤‡ä»½åŠŸèƒ½æ­£å¸¸
- [ ] å®šæ—¶ä»»åŠ¡è®¾ç½®å®Œæˆ
- [ ] å¼€æœºè‡ªå¯é…ç½®å®Œæˆ
- [ ] æ–‡æ¡£æ•´ç†å®Œæˆ

### åŠŸèƒ½éªŒè¯æ£€æŸ¥

- [ ] PostgreSQLå¯ä»¥æ­£å¸¸è¿æ¥å’ŒæŸ¥è¯¢
- [ ] Rediså¯ä»¥æ­£å¸¸è¯»å†™æ•°æ®
- [ ] Weaviate APIå¯ä»¥æ­£å¸¸è®¿é—®
- [ ] ä»å…¶ä»–æœºå™¨å¯ä»¥è¿æ¥åˆ°æœåŠ¡
- [ ] å¤‡ä»½æ–‡ä»¶å®Œæ•´ä¸”å¯ç”¨
- [ ] æœåŠ¡é‡å¯åè‡ªåŠ¨æ¢å¤
- [ ] æ—¥å¿—è®°å½•æ­£å¸¸

---

## ğŸ“ åç»­ç»´æŠ¤

### æ—¥å¸¸ç»´æŠ¤ä»»åŠ¡

1. **æ¯å‘¨æ£€æŸ¥**
   ```bash
   ./docker-setup.sh health
   ./docker-setup.sh status
   ```

2. **æ¯æœˆä»»åŠ¡**
   ```bash
   # æ¸…ç†æ—§é•œåƒ
   docker image prune -f
   
   # æ£€æŸ¥å¤‡ä»½
   ls -la backups/
   
   # æ›´æ–°é•œåƒ (å¯é€‰)
   docker compose --env-file dify.env pull
   ```

3. **å®šæœŸæ›´æ–°**
   - å…³æ³¨Dockeré•œåƒæ›´æ–°
   - å®šæœŸæ›´æ¢å¯†ç 
   - ç›‘æ§ç£ç›˜ç©ºé—´ä½¿ç”¨

### æ‰©å±•åŠŸèƒ½

å¦‚éœ€è¦ç›‘æ§ç³»ç»Ÿï¼Œå¯ä»¥è€ƒè™‘ï¼š
- æ·»åŠ Prometheus + Grafana
- é›†æˆæ—¥å¿—æ”¶é›†ç³»ç»Ÿ
- é…ç½®å‘Šè­¦é€šçŸ¥

---

## âœ… å®æ–½å®Œæˆ

æ­å–œï¼æ‚¨å·²ç»æˆåŠŸå®Œæˆäº†Difyå®¶åº­æœåŠ¡å™¨çš„Dockeréƒ¨ç½²ã€‚ç°åœ¨æ‚¨æ‹¥æœ‰äº†ä¸€ä¸ªç¨³å®šã€å¯é çš„å¼€å‘ç¯å¢ƒï¼Œå¯ä»¥æ”¯æŒDifyåº”ç”¨çš„å¼€å‘å’Œæµ‹è¯•å·¥ä½œã€‚

**ä¸‹ä¸€æ­¥å»ºè®®ï¼š**
1. åœ¨å…¶ä»–å¼€å‘æœºå™¨ä¸Šæµ‹è¯•è¿æ¥
2. å¼€å§‹éƒ¨ç½²Difyåº”ç”¨
3. æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µè°ƒæ•´é…ç½®
4. å»ºç«‹ç›‘æ§å’Œå‘Šè­¦æœºåˆ¶

docker volume ls

# æŸ¥çœ‹ç‰¹å®šæ•°æ®å·è¯¦æƒ…
docker volume inspect docker_db_postgres_data
docker volume inspect docker_db_redis_data  
docker volume inspect docker_db_weaviate_data

# æŸ¥çœ‹æ•°æ®å·å¤§å°
docker system df -v


echo "0 2 * * * cd $(pwd) && ./docker-setup-updated.sh backup" | crontab -

# ç«‹å³å¤‡ä»½
./docker-setup-updated.sh backup

# å¤‡ä»½æ–‡ä»¶ä¿å­˜åœ¨ backups/ ç›®å½•
ls -la backups/


# åœæ­¢æœåŠ¡
./docker-setup-updated.sh stop

# æ¸…ç†ç°æœ‰æ•°æ®ï¼ˆå¯é€‰ï¼‰
docker volume rm docker_db_postgres_data docker_db_redis_data docker_db_weaviate_data

# ä»å¤‡ä»½æ¢å¤ï¼ˆéœ€è¦æ‰‹åŠ¨æ“ä½œï¼‰
# 1. å¯åŠ¨æœåŠ¡åˆ›å»ºæ–°çš„ç©ºæ•°æ®å·
./docker-setup-updated.sh start

# 2. æ¢å¤PostgreSQL
cat backups/20241219_143022/postgres_backup.sql | docker exec -i dify-postgres psql -U dify -d dify

# 3. æ¢å¤Redis
docker cp backups/20241219_143022/redis_backup.rdb dify-redis:/data/dump.rdb
./docker-setup-updated.sh restart redis

# 4. æ¢å¤Weaviate
docker run --rm -v docker_db_weaviate_data:/data -v $(pwd)/backups/20241219_143022:/backup alpine tar xzf /backup/weaviate_backup.tar.gz -C /data